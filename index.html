<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sony liv</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      background: #000;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
    }
    .shaka-video-container {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }
    video {
      width: 100%;
      height: 100%;
      background: #000;
      object-fit: contain;
    }
    /* Hide shaka spinner completely */
    .shaka-spinner-container,
    .shaka-spinner,
    .shaka-spinner-svg {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }

    /* Telegram Popup Styles */
    #telegramPopup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .popup-box {
      background: #1c1c1c;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      max-width: 350px;
      color: #fff;
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.6);
    }
    .popup-box h2 {
      margin-bottom: 12px;
      color: #ffb400;
    }
    .popup-box p {
      font-size: 14px;
      margin-bottom: 20px;
    }
    .popup-box button {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .join-btn {
      background: #ffb400;
      color: #000;
      font-weight: bold;
    }
    .joined-btn {
      background: #333;
      color: #fff;
    }
  </style>
</head>
<body>

<!-- Telegram Popup -->
<div id="telegramPopup">
  <div class="popup-box">
    <h2>Support Us!</h2>
    <p>Join our Telegram channel <b>@sambhai</b> for instant updates, highlights, and exclusive links.</p>
    <button class="join-btn" onclick="window.open('https://t.me/BigBoss19Episodes','_blank')">Join Now</button>
    <button class="joined-btn" onclick="closePopup()">Already Joined</button>
  </div>
</div>

<!-- Video Container -->
<div class="shaka-video-container" data-shaka-player>
  <video autoplay playsinline preload="metadata" poster="https://www.canva.com/design/DAGwz4qydyM/p4KeRv9kAv_cVo5HGsoY2g/view?utm_content=DAGwz4qydyM&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hc092c51010"></video>
</div>

<script>
  function closePopup() {
    document.getElementById('telegramPopup').style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', async () => {
    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) {
      console.error('Browser not supported');
      return;
    }

    const video = document.querySelector('video');
    const player = new shaka.Player();
    await player.attach(video);

    const container = document.querySelector('.shaka-video-container');
    const ui = new shaka.ui.Overlay(player, container, video);

    ui.configure({
      controlPanelElements: [
        'play_pause', 'time_and_duration', 'mute', 'volume',
        'spacer', 'language', 'captions', 'picture_in_picture',
        'quality', 'fullscreen'
      ],
      volumeBarColors: { base: 'blue', level: 'white' },
      seekBarColors:   { base: 'blue', buffered: 'white', played: 'blue' }
    });

    let drmConfig = {
      clearKeys: {
        "d9025bf5bbe6502cab58edaa0b50750b": "91b5ca6ebefe3a977cb6fcae31868664"
      }
    };
    let cookieHeader = "__hdnea__=st=1756034305~exp=1756120705~acl=/*~hmac=ef2829ca981b3ca9718c4dbfda99f89078d9d0b4f43ff2a5413aef3a7675b826";
    let streamUrl = "https://jiotvmblive.cdn.jio.com/bpk-tv/Colors_HD_BTS/output/index.mpd";

    try {
      const response = await fetch('https://raw.githubusercontent.com/alex4528/m3u/refs/heads/main/jstar.m3u');
      const m3uText = await response.text();
      const lines = m3uText.split('\n');

      for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('Star_Sports_HD1')) {
          for (let j = i - 1; j >= 0; j--) {
            if (lines[j].startsWith('#EXTHTTP:')) {
              const cookieMatch = lines[j].match(/"cookie":"([^"]+)"/);
              if (cookieMatch) cookieHeader = cookieMatch[1];
              break;
            }
          }
          break;
        }
      }
    } catch (error) {
      console.error('Failed to fetch M3U:', error);
    }

    player.configure({
      drm: drmConfig,
      streaming: {
        lowLatencyMode: true,
        bufferingGoal: 15,
        rebufferingGoal: 2,
        bufferBehind: 15,
        retryParameters: {
          timeout: 10000,
          maxAttempts: 5,
          baseDelay: 300,
          backoffFactor: 1.2
        },
        segmentRequestTimeout: 8000,
        segmentPrefetchLimit: 2,
        useNativeHlsOnSafari: true
      },
      manifest: {
        retryParameters: {
          timeout: 8000,
          maxAttempts: 3
        }
      }
    });

    player.getNetworkingEngine().registerRequestFilter((type, request) => {
      request.headers['Referer'] = 'https://www.jiotv.com/';
      request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";
      request.headers['Cookie'] = cookieHeader;

      if (
        (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
          type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
        request.uris[0] && !request.uris[0].includes('__hdnea=')
      ) {
        const separator = request.uris[0].includes('?') ? '&' : '?';
        request.uris[0] += separator + cookieHeader;
      }
    });

    const enableAutoplay = () => {
      video.setAttribute('autoplay', '');
      video.setAttribute('playsinline', '');
      video.autoplay = true;
    };

    const attemptAutoplay = async () => {
      try {
        video.muted = false;
        await video.play();
        return true;
      } catch (error) {
        try {
          video.muted = true;
          await video.play();
          return true;
        } catch {
          return false;
        }
      }
    };

    player.addEventListener('error', (event) => {
      console.error('Shaka Player Error:', event.detail);
    });

    video.addEventListener('play', () => {
      if (window.self === window.top && !document.fullscreenElement && window.innerWidth <= 768) {
        container.requestFullscreen().catch(() => {});
      }
    }, { once: true });

    video.addEventListener('loadedmetadata', () => {
      video.volume = 0.8;
    });

    let hasUserInteracted = false;
    const enableSoundOnInteraction = () => {
      if (!hasUserInteracted && video.muted) {
        video.muted = false;
        hasUserInteracted = true;
      }
    };
    ['click', 'touchstart', 'keydown'].forEach(event => {
      document.addEventListener(event, enableSoundOnInteraction, { once: true });
    });

    try {
      enableAutoplay();
      await player.load(streamUrl);
      if (video.readyState >= 3) {
        await attemptAutoplay();
      } else {
        video.addEventListener('canplay', attemptAutoplay, { once: true });
        setTimeout(async () => {
          if (video.paused) await attemptAutoplay();
        }, 2000);
      }
    } catch (error) {
      console.error('Load error:', error);
    }

    document.addEventListener('visibilitychange', () => {
      if (!document.hidden && video.paused) attemptAutoplay();
    });
  });
</script>
<script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool'></script>
</body>
</html>
